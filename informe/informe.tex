%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Definición del tipo de documento.                                           %
% Posibles tipos de papel: a4paper, letterpaper, legalpapper                  %
% Posibles tamaños de letra: 10pt, 11pt, 12pt                                 %
% Posibles clases de documentos: article, report, book, slides                %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\documentclass[a4paper,10pt]{article}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Los paquetes permiten ampliar las capacidades de LaTeX.                     %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Paquete para inclusión de gráficos.
\usepackage{graphicx}

% Paquete para definir la codificación del conjunto de caracteres usado
% (latin1 es ISO 8859-1).
\usepackage[latin1]{inputenc}

% Paquete para definir el idioma usado.
\usepackage[spanish]{babel}


% Título principal del documento.
\title{		\textbf{Trabajo Práctico 2: Data path y pipeline}}

% Información sobre los autores.
\author{	José Ignacio Sbruzzi, \textit{Padrón Nro. 97.452}                     \\
            \texttt{ jose\_sbruzzi@hotmail.com }                                              \\
            Leandro Huemul Desuque, \textit{Padrón Nro. 95.836}                     \\
            \texttt{ desuqueleandro@gmail.com }                                              \\[2.5ex]
            \normalsize{2do. Cuatrimestre de 2016}                       \\
            \normalsize{66.20 Organización de Computadoras}                             \\
            \normalsize{Facultad de Ingeniería, Universidad de Buenos Aires}            \\
       }
\date{}



\begin{document}

% Inserta el título.
\maketitle

% Quita el número en la primer página.
\thispagestyle{empty}

% Resumen
\begin{abstract}
Se introdujeron modificaciones sobre datapaths para agregar ciertas 
funcionalidades a los mismos. El objetivo del trabajo es la práctica 
y el aprendizaje del funcionamiento del datapath.
\end{abstract}

\section{Introducción}
MIPS ES....
LOS DATAPATHS SON...
% \textit{66.20 Organización de Computadoras} ESTO PONE TEXTO EN CURSIVA

\section{Desarrollo}
\subsection{Modificación del DP monociclo}
La modificación introducida fue una nueva instrucción denominada "load 
byte unsigned" (mnemónico lbu), que en vez de cargar un word como lw, 
carga un byte, y no hace extensión de signo: los bits a la izquierda del
último son simpre 0.
\begin{figure}[!htp]
\begin{center}
\includegraphics[width=0.4\textwidth]{imagenes/lbu_monocycle.eps.eps}
\end{center}
\caption{Estado final del datapath monociclo} \label{fig:stack}
\end{figure}

\subsubsection{Procedimiento de la modificación }
Luego de notar que incluso al recibir direcciones desalineadas la memoria
carga una palabra alineada (es decir, por ejemplo, las direcciones 0, 1, 
2 y 3 hacen que se carge la palabra en la dirección 0), se decidio hacer
que lbu funcionara exactamente igual que lw, pero removiendo 3 bytes, 
haciendo parecer de esta manera que se carga un solo byte.

Para esto, se agregó una señal a la unidad de control llamada "cortar".
La señal impacta el sistema por medio de un multiplexor que define si se
guardará en el register file la palabra obtenida de memoria o una versión
modificada que mantiene un sólo byte. El word modificado se calcula 
incluso si la señal "cortar" es 0.

La modificación del word es ejecutada por cuatro unidades \textit{Shift 
Left}: cada una deja un byte distinto en la parte más significativa del
word. Luego, por medio de un multiplexor se elige cuál de los 4 words
generados mantener, a partir de los últimos dos bits de la dirección de
memoria que llega a la entrada "Address" de la memoria de datos. Luego, 
el word emitido por este último multiplexor es modificado por medio de un
distribuidor y un concatenador para que el byte figure en la dparte más 
baja.

No se cuenta con los elementos para que la implementación sea mejor: lo 
ideal sería agregar una única unidad de Sift left que haga un 
desplazamiento que se pueda variar, y de esta manera no serían necesarias 4.
Además sería bueno disponer de una unidad de shift right en vez de usar 
el concatenador y el distribuidor para lograr ese efecto.

\subsubsection{Pruebas}
A continuación se muestra un fragmento de assembler que debe dejar tales registros de tal manera
%.data
%prueba: .word 0xAABBCCDD, 0x11223344, 0x22222222, 0x33333333
%
%.text
%
%mostrar:
%		la $t5, prueba
%		lbu $t0, 0($t5)
%		lbu $t1, 1($t5)
%		lbu $t2, 2($t5)
%		lbu $t3, 3($t5)

%\subsubsection{\texttt{Especificaciones}}

%\begin{figure}[!htp]
%\begin{center}
%\includegraphics[width=0.4\textwidth]{imagenes/imagenStack.eps}
%\end{center}
%\caption{Stack de la función vecinos} \label{fig:stack}
%\end{figure}
%
%Se reservaron 12 bytes para el área de SRA, 4 bytes para salvar el registro \textit{ra} (no era necesario ya que en ningun momento los saltos para realizar comparaciones modifican el ra, de cualquier forma y como buena práctica, se guardó su valor), 4 bytes para salvar el registro \textit{gp} y 4 bytes para salvar el registro \textit{fp}.
%
%Al tratarse de una matriz cuadrada (MxM), el cálculo de la posición relativa se hizo utilizando solo el ancho. Se pasó el alto para cumplir con la firma pedida por el trabajo práctico y para contemplar posibles mejoras u optimizaciones a futuro (por ejemplo, que se permitan matrices de MxN). Se reservaron 16 bytes en concepto de ABA, respetando ABI. ~\ref{fig:stack}.
%
%\subsection{Dificultades}
%La construcción de una imagen en formato PBM presentó algunas dificultades ya que se usó PBM en vez de plain PBM, y en la descripción del formato PBM no había ejemplos de archivos PBM (sí los había de plain PBM). Un punto relativamente problemático del formato PBM es que cada pixel está asociado a un bit. Para evitar esta dificultad, se decidió que cada celda correspondería a un cuadrado de 8x8 pixeles, simplificando el fragmento del programa que guarda las imágenes.
%
%\section{Compilación}
%En lugar de utilizar un \textit{makefile} se optó por programar un script (\textit{hacer.sh}) para dicha tarea, que cumple el mismo objetivo: ejecutar las instrucciones adecuadas de compilacion. 
%
%Se compilan de manera individual cada uno de los archivos fuente de extension \textit{c} y \textit{S} a traves del ejecutable \textit{gcc}.
%
%Los argumentos utilizados para la compilación son los siguientes:
%
%\begin{description}
%\item[-c] Compila el código fuente pero no corre el linker. Genera el código objeto.
%
%\item[-o] Especifica el archivo de salida (ya sea un archivo objeto, ejecutable, ensamblado).
%
%\item[-Wall] Activa los mensajes de warning.
%
%\item[-I] Agrega el directorio especificado a la lista de directorios buscados para los archivos header
%\end{description}

\section{Resultados}
\subsection{Ventajas de implementar lbu}
A continuación se muestra una función assembly que ejecuta el lbu.


Puede concluirse que ejecutar una operación equivalente al lbu descripto
lleva como 1000000 instrucciones o ciclos más pq es monocycle
%
%\begin{table}[h!t]
%\centering
%\begin{tabular}{| l | r | m | n |}
%  \hline
%  Archivo	& Pasos &	Tiempo de ejecución(C)	& Tiempo de ejecución (MIPS)\\ \hline
%  Glider	& 10	&\(0.022s\) 	&\(2.248s\) \\
%  Glider	& 100	&\(0.124s\) 	&\(14.769s\) \\
%  Glider	& 1000	&\(1.620s\) 	&\(157.485s\) \\
%
%  \hline
%
%\end{tabular}
%
%\begin{tabular}{| l | r | m | n |}
%  \hline
%  Archivo	& Pasos &	Tiempo de ejecución(C)	& Tiempo de ejecución (MIPS)\\ \hline
%  Pento	& 10	&\(0.013s\) 	&\(1.43s\) \\
%  Pento	& 100	&\(0.089s\) 	&\(14.983s\) \\
%  Pento	& 1000	&\(1.629s\) 	&\(163.15s\) \\
%
%  \hline
%
%\end{tabular}

%\begin{tabular}{| l | r | m | n |}
%  \hline
%  Archivo	& Pasos &	Tiempo de ejecución(C)	& Tiempo de ejecución (MIPS)\\ \hline
%  Sapo	& 10	&\(0.052s\) 	&\(1.092s\) \\
%  Sapo	& 100	&\(0.253s\) 	&\(18.252s\) \\
%  Sapo	& 1000	&\(1.904s\) 	&\(172.32s\) \\
%
%  \hline
%\end{tabular}


%\caption{Tiempos medidos}
%\label{tab:resultados}
%\end{table}

\section{Conclusiones}



% Citas bibliográficas.
\begin{thebibliography}{99}

\bibitem{Conway} Gardner, Martin. ``Mathematical Games - The fantastic combinations of John Conway's new solitaire game 'life` '' Scientific America, 223. pp. 120-123. ISBN 0-89454-001-7. Archivado del original en: https://ddi.cs.uni-potsdam.de/HyFISCH/Produzieren/lis\_projekt/proj\_gamelife/ConwaySci-entificAmerican.htm

Consultado en septiembre 2016.

\bibitem{GXemul} Sitio web de GXemul http://gxemul.sourceforge.net/

Consultado en septiembre 2016.

\end{thebibliography}

\end{document}
